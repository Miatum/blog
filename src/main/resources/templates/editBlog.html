<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Miatum's blog</title>
    <script src="/js/jquery.min.js"></script>
    <script src="/editor.md/editormd.js"></script>
    <script src="/layui/layui.js"></script>
    <link rel="icon" type="image/x-ico" href="/pic/logo.ico">
    <link rel="stylesheet" type="text/css" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/editor.md/css/editormd.css">
    <link rel="stylesheet" type="text/css" href="/css/manage.css">
</head>
<style>
    /**
    *@Author: miatum
    *@Description: 将editor.md编辑模块放入layui form中会产生冲突，lyaui对所有form的后代select标签设置了display：none；
    *@Date: 0:23 2020/10/12
    */
    .editormd-code-toolbar select{
        display: inline;
    }
</style>
<body>
<div>
    <header>
        <a class="logo" href="/">Miatum</a>
    </header>
    <nav>
        <ul class="layui-nav layui-nav-tree">
            <li class="layui-nav-item"><a href="/manageBlog">管理博客</a></li>
            <li class="layui-nav-item"><a href="/manageBlogType">博客类别</a></li>
            <li class="layui-nav-item"><a href="/manageBlogTag">博客标签</a></li>
            <li class="layui-nav-item"><a href="/manageUser">用户管理</a></li>
        </ul>
    </nav>
    <main>
        <form class="layui-form layui-form-pane">
            <input type="text" style="display: none" name="id" th:value="${blog.getId()}">
            <div class="layui-form-item">
                <label class="layui-form-label">标题</label>
                <div class="layui-input-block">
                    <input type="text" name="title" autocomplete="off" placeholder="请输入标题" class="layui-input" th:value="${blog.getTitle()}">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">摘要</label>
                <div class="layui-input-block">
                    <input type="text" name="intro" autocomplete="off" placeholder="摘要" class="layui-input" th:value="${blog.getIntro()}">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">封面图片</label>
                <div class="layui-input-block">
                    <input type="text" name="cover" autocomplete="off" placeholder="图片地址" class="layui-input" th:value="${blog.getCover()}">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">作者</label>
                <div class="layui-input-inline">
                    <input type="text" name="author" autocomplete="off" placeholder="" class="layui-input" th:value="${blog.getAuthor()}">
                </div>
                <label class="layui-form-label">分类</label>
                <div class="layui-input-inline">
                    <select name="type_id">
                        <option value="">请选择分类</option>
                        <option th:each="blog_type : ${blog_types}" th:text="${blog_type.getType_name()}" th:selected="${blog.getType_id() eq blog_type.getId()}" th:value="${blog_type.getId()}"></option>
                    </select>
                </div>
                <label class="layui-form-label">标签</label>
                <div class="layui-input-inline">
                    <select name="tag_id">
                        <option value="">请选择标签</option>
                        <option th:each="blog_tag : ${blog_tags}" th:text="${blog_tag.getTag_name()}" th:selected="${blog.getTag_id() eq blog_tag.getId()}" th:value="${blog_tag.getId()}"></option>
                    </select>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">日期选择</label>
                    <div class="layui-input-block">
                        <input type="text" name="date" id="date" autocomplete="off" class="layui-input" th:value="${blog.getStringDate()}">
                    </div>
                </div>
            </div>
            <div id="editor">
                <textarea style="display: none;" name="content" th:text="${blog.getContent()}"></textarea>
            </div>
            <div class="layui-form-item">
                <button type="submit" class="layui-btn layui-btn-primary" lay-submit="" lay-filter="update">保存</button>
            </div>
        </form>
    </main>
</div>
<script type="text/javascript">
    /**
    *@Author: miatum
    *@Description: layui
    *@Date: 14:40 2020/10/10
    */
    layui.use(['element','form','laydate'], function(){
        var element = layui.element;
        var form=layui.form;
        var laydate=layui.laydate;
        laydate.render({
            elem: '#date',
            type: 'datetime'
        });
        form.on('submit(update)',function (data) {
            var blog = data.field;
            $.ajax({
                type : "POST",
                url : "/updateBlog",
                contentType : "application/json",
                dataType : "json",
                data : JSON.stringify(blog),
                success : function (result) {
                    layer.msg("保存成功");
                },
                error : function(e){
                    layer.msg("保存失败");
                }
            });
           return false;
        });
    });

</script>
<script type="text/javascript">
    /**
    *@Author: miatum
    *@Description: editor编辑器
    *@Date: 14:41 2020/10/10
    */
    var editor;
    $(function() {
        editor = editormd("editor", {
            width: "100%",
            height: 600,
            path : '/editor.md/lib/',
            imageUpload : true,
            imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL : "/savePicByFormData",
        });
    });
</script>
</body>
</html>